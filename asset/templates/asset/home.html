<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://kit.fontawesome.com/ae360af17e.js" crossorigin="anonymous"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
       
          <style>
            @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');
    
            *,
            ::after,
            ::before {
                box-sizing: border-box;
            }
    
            body {
                font-family: 'Poppins', sans-serif;
                margin: 0;
                background: #edeae6;
                background-repeat: no-repeat;
                background-position: center bottom;
                background-size: cover;
                animation: bg-animation 10s ease-in-out infinite;
            }
    
            h3 {
                font-size: 1.2375rem;
                color: #fff;
            }
    
            a {
                cursor: pointer;
                text-decoration: none;
                font-family: 'Poppins', sans-serif;
            }
    
            li {
                list-style: none;
            }
    
            /* Layout skeleton */
    
            .wrapper {
                align-items: stretch;
                display: flex;
                width: 100%;
            }
    
            #sidebar {
                max-width: 264px;
                min-width: 264px;
                transition: all 0.35s ease-in-out;
                box-shadow: 0 0 35px 0 rgba(49, 57, 66, 0.5);
                z-index: 1111;
                background-color: #565d6c;
            }
    
            /* Sidebar collapse */
    
            #sidebar.collapsed {
                margin-left: -264px;
            }
    
            .main {
                display: flex;
                flex-direction: column;
                min-height: 100vh;
                width: 100%;
                overflow: hidden;
                transition: all 0.35s ease-in-out;
                position: relative; /* Ensure relative positioning for absolute centering */
            }
    
            .sidebar-logo {
                padding: 1.15rem 1.5rem;
            }
    
            .sidebar-logo a {
                color: #e9ecef;
                font-size: 1.25rem;
                font-weight: 600;
            }
    
            .sidebar-nav {
                padding: 0;
            }
    
            .sidebar-header {
                color: #e9ecef;
                font-size: .75rem;
                padding: 1.5rem 1.5rem .375rem;
            }
    
            a.sidebar-link {
                padding: .625rem 1.625rem;
                color: #e9ecef;
                position: relative;
                display: block;
                font-size: 1rem;
            }
    
            .sidebar-link[data-bs-toggle="collapse"]::after {
                border: solid;
                border-width: 0 .075rem .075rem 0;
                content: "";
                display: inline-block;
                padding: 2px;
                position: absolute;
                right: 1.5rem;
                top: 1.4rem;
                transform: rotate(-135deg);
                transition: all .2s ease-out;
            }
    
            .sidebar-link[data-bs-toggle="collapse"].collapsed::after {
                transform: rotate(45deg);
                transition: all .2s ease-out;
            }
    
            .content {
                flex: 1;
                max-width: 100vw;
                width: 100vw;
            }
    
            .card {
                margin-right: auto;
                margin-left: auto;
                box-shadow: 0 15px 25px rgba(129, 124, 124, 0.2);
                border-radius: 5px;
                backdrop-filter: blur(14px);
                background-color: rgba(255, 255, 255, 0.2);
                padding: 10px;
                text-align: center;
            }
    
           .btn-custom {
                background-color: #0047AB;
                border: none;
                border-radius: 25px;
                padding: 10px 20px;
                color: #fff;
                font-weight: bold;
                transition: background-color 0.3s ease;
                text-align: center;
            }
    
           .btn-custom:hover {
                background-color: #002080;
            }
    
            /* Responsive */
    
            @media (min-width: 768px) {
               .content {
                    width: auto;
                }
            }
    
           .collapsed {
                display: none; /* Initially hide the collapsed nav */
            }
    
          
        
           .card {
                position: relative;
                width: 225px; /* Adjust width as needed */
                overflow: hidden;
                /* border-radius: 10px; Add border-radius for rounded corners */
                transition: transform 0.3s ease-out;
                background-color: white;
            }
    
          
            .card:hover {
                transform: scale(1.05); /* Zoom effect on hover */
            }

            .card-body {
                position: relative;
                height:fit-content;
                padding-bottom: 0px;
                text-align: left;
                color:black;
            }

            .card-text {
                display: -webkit-box;
                -webkit-line-clamp: 1; /* Limit to 1 line */
                -webkit-box-orient: vertical;
                overflow: hidden;
                text-overflow: ellipsis;
                line-height: 1.2em; /* Adjust line height for proper ellipsis display */
                max-height: 1.2em; /* Limit the height to show only one line */
                transition: max-height 0.3s ease-out, color 0.3s ease-out; /* Add color transition */
                color: black;
            }

            .card:hover .card-text{
                max-height: 100px; /* Adjust this value to match your content height */
                overflow: visible;
                transition: max-height 0.3s ease-in, color 0.3s ease-in; /* Adjust transition */
                cursor: pointer;
                color: #000; /* Change text color on hover */
                -webkit-line-clamp: unset; /* Remove line clamp on hover */
            }

            .card .hi {
                display: none;
                transition: opacity 0.3s ease; /* Smooth transition for opacity */
            }

            .card:hover .hi {
                display: block;
                opacity: 1; /* Show the hi div on hover */
            }

            /* Updated transitions for sidebar and nav links */
            /* Sidebar transition */
            #sidebar {
                max-width: 264px;
                min-width: 264px;
                transition: margin-left 0.35s ease-in-out; /* Transition margin-left for sidebar */
                box-shadow: 0 0 35px 0 rgba(49, 57, 66, 0.5);
                z-index: 1111;
            }
    
            #sidebar.collapsed {
                margin-left: -264px; /* Slide sidebar out */
            }
    
        
    
           #msgp{
                color:white;
                font-weight: bolder;
                font-size: x-large ;
                margin-top: 50%;
            }
    
           #searchInput{
                margin-top: 20px;
                max-width:500px ;
                background-color: white;
                border-radius: 5px 0px 0px 5px;
                border: none;
                box-shadow: none;  
                height:37px;        
              }

           .hidden {
                opacity: 0;
                height: 0;
                overflow: hidden;
                transition: opacity 0.3s ease, height 0.3s ease;
            }
    
          
           .sidebar-item.separator {
        border-bottom: 1px solid #ccc;
        margin-bottom: 10px;
        margin-top: 20px;
    }

    #searchButton{
        height:37px;
        position: relative;
        margin-top: 20px;
        color: white;
        background-color: #565d6c;
        border: 3px solid #565d6c;
        border-radius: 0px 5px 5px 0px;  
    }

    .sidebar-item.separator {
        border-bottom: 1px solid #ccc;
        margin-bottom: 10px;
        margin-top: 20px;
        min-width:264px;
    }
    
   
#hi{
        margin-left: 25px;
        margin-top:-5px;
        margin-bottom: 5px;
        position: fixed;
        bottom:0;
}


.speci { position: fixed; bottom: 0; margin: 0 auto; top:550px; } 
    
        </style>
    <title>Sidebar With Bootstrap</title>
</head>

<body>
    <div class="wrapper">
        <!-- Sidebar -->
       <!-- Sidebar -->
<aside id="sidebar">
    <div class="h-100 sidebar-container">
        <div class="sidebar-logo">
            <a href="{% url 'home' %}" style="display: flex; justify-content: space-between; align-items: center;">
                <span>INTRA TRADE</span>
                <i class="fas fa-home" style="font-size: medium;"></i>
            </a>
        </div>
        
       
            

        <!-- SEARCH BAR -->
      
        <ul class="sidebar-nav">
            <li class="sidebar-item">
                <a href="?type=all" class="sidebar-link {% if product_type == 'all' %}active{% endif %}">
                    <i class="fa-regular fa-file-lines pe-2"></i>
                    All
                </a>
            </li>
        
            {% for product_type, products in grouped_products.items %}
                <li class="sidebar-item sidebar-dropdown-parent {% if product_type == active_type %}active{% endif %}">
                    <a href="?type={{ product_type }}" class="sidebar-link" data-bs-toggle="collapse" data-bs-target="#{{ product_type }}" aria-expanded="false" aria-controls="{{ product_type }}" data-category="{{ product_type }}">
                        {{ product_type|title }}
                    </a>
                    <ul id="{{ product_type }}" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#pages">
                        {% for product in products %}
                            <li class="sidebar-item sidebar-dropdown-child">
                                <a href="?type={{ product.name }}" class="sidebar-link {% if product_type == product.name %}active{% endif %}" data-category="{{ product.name }}">
                                    {{ product.name }}
                                </a>
                            </li>
                        {% endfor %}
                    </ul>
                </li>
            {% endfor %}
            <div class="speci">
            <!-- Add a separator before the logout/login links -->
            <li class="sidebar-item separator" ></li>

            

            <!-- Move the Links button to the bottom of the sidebar -->
            <li class="sidebar-item">
                <a href="#" class="sidebar-link" data-bs-toggle="collapse" data-bs-target="#auth"
                   aria-expanded="false" aria-controls="auth">
                    <i class="fa-solid fa-link pe-2"></i>
                    Links
                </a>
                <ul id="auth" class="sidebar-dropdown list-unstyled collapse" data-bs-parent="#pages">
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'requestpost' %}">Post Product</a>
                    </li>
                    {% if flagh %}
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'view_request_post' %}">Post Product Approval</a>
                    </li>
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'view_request_item' %}">Interest Approval</a>
                    </li>
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'view_interests' %}">View Interested People</a>
                    </li>
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'displaysent' %}">Dashboard</a>
                    </li>
                    {% endif %}
                    {% if flagb %}
                    <li class="sidebar-item">
                        <a class="dropdown-item sidebar-link" href="{% url 'view_interests_finance' %}">B&F Approval</a>
                    </li>
                    {% endif %}
                </ul>
            </li>
            </div>
            <div id="hi">
                {% if user.is_authenticated %}
                <i class="fas fa-user-circle text-light"></i><a class="p-2 text-light">HI, {{user.username}}</a>
                {% endif %}
        
          
            <table>
                <tr>
                    <td>
            {% if user.is_authenticated %}
                <li class="sidebar-link" style="display: block;text-align: left;margin-left:-27px;">
                    <a class="sidebar-link" href="{% url 'logout' %}" id="logoutLink" onclick="handleLogout()">Log Out</a>
                </li>
            {% else %}
                <li class="sidebar-link" style="display: block;text-align: left;margin-left:-27px;">
                    <a class="sidebar-link" href="{% url 'login' %}">Log In</a>
                </li>
            {% endif %}
        </td>
            <td>
            <li class="nav-item" id="load" style="display: none;"><div id="loadingOverlay" class="top-0 start-0 w-100  h-100 d-flex align-items-center justify-content-center">
                <div class="spinner-border spinner-border-md text-light" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </li>
    </td>
    </tr>
    </table>
    </div>
    </ul>
    </div>
</aside>
        <!-- Main Component -->
        <div class="main">
            <main class="content px-3 py-2">
                <div class="search-container d-flex justify-content-center">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
                    <button class="btn" type="button" id="searchButton" disabled>
                        <i class="fas fa-search"></i>
                    </button>                    
                </div>                
                <div class="container-fluid mt-5">
                  <div class="mb-3">
                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 row-cols-xl-4 row-cols-xxl-5">
                        {% if page_obj %}
                            {% for item in page_obj %}
                            <div class="col mb-4">
                                <div class="card">
                                    <a href="{% url 'request_item' item.id %}" style="cursor: pointer;">
                                        <img class="card-img-top" src="{{ item.ProductImage.url }}" alt="{{ item.ProductName }}" style="height: 200px; object-fit: cover;">
                                        <div class="card-body">
                                            <h5 class="card-text">{{ item.ProductName }}</h5>
                                            <p class="card-text" >{{ item.ProductDesc }}</p>
                                            <p class="card-text">{{item.created.date}}</p>
                                            <p class="card-text" style="text-align: right;"><i class="fas fa-users"></i>&nbsp;&nbsp;{{ item.interest_count }}</p>
                                        </div>
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>  
                        <!-- Pagination Controls -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination" style="position: absolute;bottom: 0;" >
                                {% if page_obj.has_previous %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if product_type %}&type={{ product_type }}{% endif %}" style="width: 90px;">Previous</a>
                                    </li>
                                {% endif %}
                                {% for num in page_obj.paginator.page_range %}
                                    <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                                        <a class="page-link" href="?page={{ num }}{% if product_type %}&type={{ product_type }}{% endif %}">{{ num }}</a>
                                    </li>
                                {% endfor %}
                                {% if page_obj.has_next %}
                                    <li class="page-item">
                                        <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if product_type %}&type={{ product_type }}{% endif %}" style="width: 90px;text-align: center;">Next</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% else %}
                        <div class="col text-center">
                            <p id="msgp">No items available</p>
                        </div>
                    {% endif %}

                        
                                      
                  </div>
                </div>
              </main>
    </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"></script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const logoutLink = document.querySelector("#logoutLink");
                const loading = document.querySelector("#load");
                const searchInput = document.getElementById('searchInput');
                const itemsContainer = document.querySelector('.row-cols-1');
                const sidebarDropdownToggles = document.querySelectorAll(".sidebar-link[data-bs-toggle='collapse']");
        
                searchInput.addEventListener('keyup', function () {
                    const searchText = searchInput.value.trim();
                    const activeType = document.querySelector('.sidebar-link.active')?.textContent.trim();
                    const page = 1; // Set the initial page number to 1
                    const url = `/search-products/?search=${encodeURIComponent(searchText)}&type=${encodeURIComponent(activeType)}&page=${page}`;
        
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            // Clear existing items
                            itemsContainer.innerHTML = '';
        
                            // Iterate over fetched data and append each item
                            data.forEach(item => {
                                const itemHTML = `
                                    <div class="col mb-4">
                                        <div class="card" style="width: 80%;">
                                            <a href="/request_item/${item.id}/" style="cursor: pointer;">
                                                <img class="card-img-top" src="${item.ProductImage}" alt="${item.ProductName}" style="height: 200px; object-fit: cover;">
                                                <div class="card-body">
                                                    <h5 class="card-title">${item.ProductName}</h5>
                                                    <p class="card-text">${item.ProductDesc}</p>
                                                    <p class="card-text" style="text-align: right;"><i class="fas fa-users"></i>&nbsp;&nbsp;${item.interest_count}</p>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                `;
                                itemsContainer.insertAdjacentHTML('beforeend', itemHTML);
                            });
        
                            // Add pagination links (You need to adjust this part based on your pagination logic)
                            // Here I'll assume page_data is available as part of your fetch response
                            const paginationContainer = document.createElement('div');
                            paginationContainer.classList.add('pagination');
                            paginationContainer.innerHTML = page_links(data.page_data); // Assuming page_data is part of your response
                            itemsContainer.parentNode.insertBefore(paginationContainer, itemsContainer.nextSibling);
                        })
                        .catch(error => console.error('Error fetching data:', error));
                });
        
                // Helper function to generate pagination links
                function page_links(page_data) {
                    let links = '';
        
                    if (page_data.has_previous) {
                        const prev_page = page_data.previous_page_number();
                        links += `<a href="/search-products/?search=${encodeURIComponent(searchText)}&type=${encodeURIComponent(activeType)}&page=${prev_page}">Previous</a>`;
                    }
        
                    for (let i = 1; i <= page_data.paginator.num_pages; i++) {
                        if (i == page_data.number) {
                            links += `<span>${i}</span>`;
                        } else {
                            links += `<a href="/search-products/?search=${encodeURIComponent(searchText)}&type=${encodeURIComponent(activeType)}&page=${i}">${i}</a>`;
                        }
                    }
        
                    if (page_data.has_next) {
                        const next_page = page_data.next_page_number();
                        links += `<a href="/search-products/?search=${encodeURIComponent(searchText)}&type=${encodeURIComponent(activeType)}&page=${next_page}">Next</a>`;
                    }
        
                    return links;
                }
        
                // Event listener for logout link
                logoutLink.addEventListener("click", function (event) {
                    event.preventDefault();
                    loading.style.display = "block";
                    setTimeout(function () {
                        loading.style.display = "none";
                        window.location.href = logoutLink.getAttribute("href");
                    }, 1000);
                });
        
                // Event listener for sidebar dropdown toggles
                sidebarDropdownToggles.forEach((toggle) => {
                    toggle.addEventListener("click", function () {
                        const target = toggle.getAttribute("data-bs-target");
                        const collapseElement = document.querySelector(target);
        
                        // Close all other open dropdowns
                        sidebarDropdownToggles.forEach((otherToggle) => {
                            if (otherToggle !== toggle && otherToggle.dataset.category !== toggle.dataset.category) {
                                const otherTarget = otherToggle.getAttribute("data-bs-target");
                                const otherCollapseElement = document.querySelector(otherTarget);
                                if (otherCollapseElement.classList.contains("show")) {
                                    otherCollapseElement.classList.remove("show");
                                }
                            }
                        });
        
                        // Toggle the clicked dropdown
                        collapseElement.classList.toggle("show");
                    });
                });
            });
        </script>
        
</body>

</html>
